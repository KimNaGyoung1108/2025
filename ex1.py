import streamlit as st

# 증상 키워드 사전
symptom_keywords = {
    "두통": ["머리아파", "머리 아파", "두통", "머리 지끈", "머리 울림", "머리 깨질 것 같아"],
    "열": ["열", "열 나", "열이 나", "고열", "몸 뜨거워", "열남", "체온 상승"],
    "기침": ["기침", "기침 나", "기침이 심해", "콜록", "목 간질", "계속 기침해"],
    "코막힘": ["코막힘", "코 막힘", "숨쉬기 힘들어", "비강 막힘", "코 답답해"],
    "목아픔": ["목 아파", "목 따가워", "목이 부었어", "삼킬 때 아파", "인후통"],
    "복통": ["배 아파", "복통", "속쓰림", "장 아파", "배가 뒤틀려", "위가 아파"],
    "설사": ["설사", "화장실 자주", "묽은 변", "배탈", "변이 물같아"],
    "구토": ["토함", "토할 것 같아", "메슥거려", "구역질", "위에서 올라와"],
    "피로": ["피곤해", "기운이 없어", "무기력", "에너지 없음", "몸이 축 늘어져"],
    "근육통": ["근육통", "몸살", "근육 아파", "몸이 쑤셔", "팔다리가 아파"],
}

# 증상별 질병 및 해결 방법
symptom_db = {
    "두통": {
        "질병": ["긴장성 두통", "편두통", "감기"],
        "해결책": [
            "조용하고 어두운 곳에서 휴식",
            "수분 섭취 늘리기",
            "필요 시 진통제 복용",
            "지속되면 신경과 진료"
        ]
    },
    "열": {
        "질병": ["감기", "독감", "코로나19", "세균 감염"],
        "해결책": [
            "해열제 복용 (예: 타이레놀)",
            "수분 보충",
            "얇은 옷 입고 체온 조절",
            "지속되면 병원 방문"
        ]
    },
    "기침": {
        "질병": ["감기", "기관지염", "폐렴"],
        "해결책": [
            "따뜻한 물 마시기",
            "가습기 사용",
            "기침약 복용",
            "2주 이상 지속되면 병원 방문"
        ]
    },
    "코막힘": {
        "질병": ["비염", "감기", "부비동염"],
        "해결책": [
            "생리식염수로 코 세척",
            "가습기 사용",
            "비충혈 제거제 사용",
            "장기 지속 시 이비인후과 진료"
        ]
    },
    "목아픔": {
        "질병": ["감기", "인후염", "편도염"],
        "해결책": [
            "소금물 가글",
            "따뜻한 차 마시기",
            "진통제 복용",
            "고열 동반 시 병원 방문"
        ]
    },
    "복통": {
        "질병": ["장염", "소화불량", "위염"],
        "해결책": [
            "자극적인 음식 피하기",
            "소화제 복용",
            "복부 찜질",
            "지속 시 내과 진료"
        ]
    },
    "설사": {
        "질병": ["식중독", "장염", "과민성 대장"],
        "해결책": [
            "수분 보충 (ORS 등)",
            "자극적인 음식 피하기",
            "탈수 증상 확인",
            "설사 지속 시 병원 방문"
        ]
    },
    "구토": {
        "질병": ["위염", "장염", "식중독"],
        "해결책": [
            "수분 섭취 유지",
            "과식 피하고 금식 필요 시 고려",
            "구토 억제제 복용 (의사 상담)",
            "반복될 경우 진료 필요"
        ]
    },
    "피로": {
        "질병": ["감기", "빈혈", "수면 부족", "갑상선 기능 저하"],
        "해결책": [
            "충분한 수면과 휴식",
            "영양 섭취 강화",
            "지속될 경우 혈액 검사 추천",
            "기저질환 확인 위해 병원 방문"
        ]
    },
    "근육통": {
        "질병": ["독감", "근육 과사용", "몸살"],
        "해결책": [
            "온찜질 또는 마사지",
            "진통소염제 복용",
            "충분한 휴식",
            "통증 지속 시 병원 진료"
        ]
    },
}

# 증상 추출 함수 (공백 제거 후 키워드 매칭)
def extract_symptoms(text):
    detected = set()
    lower_text = text.lower().replace(" ", "")
    for symptom, keywords in symptom_keywords.items():
        for keyword in keywords:
            if keyword.replace(" ", "") in lower_text:
                detected.add(symptom)
                break
    return list(detected)

# Streamlit UI
st.title("🩺 증상 기반 건강 조언 앱")
st.write("자연스럽게 증상을 입력해보세요! 예: '열 나 머리아파'")

user_input = st.text_input("증상 입력:")

if user_input:
    matched = extract_symptoms(user_input)
    if matched:
        for symptom in matched:
            st.subheader(f"🔍 '{symptom}' 관련 정보")
            st.markdown(f"**의심 질병:** {', '.join(symptom_db[symptom]['질병'])}")
            st.markdown("**해결 방법:**")
            for solution in symptom_db[symptom]["해결책"]:
                st.markdown(f"- {solution}")
    else:
        st.warning("인식 가능한 증상이 없습니다. 더 자세히 입력해보세요.")

